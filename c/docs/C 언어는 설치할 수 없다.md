#### 인덱스
- [C 언어는 설치할 수 없다 - 컴파일러](#c-언어는-설치할-수-없다---컴파일러)
- [C 표준 라이브러리 구현체 - libc (ABI)](#c-표준-라이브러리-구현체---libc-abi)
- [POSIX](#posix)
- [C 표준](#c-표준)
- [최종 정리: C 표준, 컴파일러, libc, OS ABI, POSIX, 로더/커널, CPU/ISA](#최종-정리-c-표준-컴파일러-libc-os-abi-posix-로더커널-cpuisa)


## C 언어는 설치할 수 없다 - 컴파일러

파이썬, 자바 등 다른 언어는 실행 환경 자체(VM, 인터프리터, 표준 라이브러리 등)가 언어의 일부이기 때문에 "설치"가 필요하다

반면 C의 경우 실행 환경을 정의하지 않고 OS에 위임하기 때문에 C 언어 자체를 다운로드할 수 없다

C 언어는 실행 파일, 라이브러리, 런타임, VM이 아니라 문법과 의미 규칙의 덩어리이다

이런 문법이 있고, 이런 의미로 해석해야 되고, 이런 동작은 정의되거나 되지 않는다를 결정할 뿐이다

C 언어가 시스템 언어일 수 있는 이유는 어떤 실행 환경도 제공하지 않기 때문이다

그래서 모든 OS가 C를 쓰고, 모든 ISA가 C를 지원하고, 모든 컴파일러가 C를 구현할 수 있다

아래와 같이 당장 C 파일을 하나 작성하고 컴파일을 한 뒤 실행하면 Hello World 문자열이 콘솔에 출력되는 것을 볼 수 있다

```c
// hello.c
#include <stdio.h>

int main()
{
	printf("Hello World");
	return 0;
}
```

```shell
# clang ./hello.c
$ gcc ./hello.c
$ ./a.out
```

C 언어가 문서라면 이를 구현하는 것은 컴파일러이다

컴파일러는 C 문서에 명시된 규칙을 코드로 구현하며 여러 C 표준을 지원한다 (clang 17은 C99, C11, C17, C23를 지원함)

즉, C 언어는 실행 파일이 아니고 표준 문서일 뿐이며 이를 clang, gcc, MSCV와 같은 컴파일러가 구현하기 때문에 C 언어 자체를 설치할 수 없음과 동시에 설치할 필요없이 C 언어로 작성된 프로그램을 실행시킬 수 있는 것이다


## C 표준 라이브러리 구현체 - libc (ABI)

사실 컴파일러만으로는 C 언어 프로그램을 실행할 수 없다

위에서 `stdio.h` 헤더 파일과 `printf` 함수는 어떻게 사용할 수 있을까?

`printf`와 같은 함수는 **libc**라고 하는 C 표준 라이브러리 구현체를 운영체제에서 컴파일러와 함께 기본적으로 제공한다

libc는 C 언어 표준을 만족하도록 구현된 OS 종속 라이브러리로 C 표준이 함수 목록과 의미를 정의하면, OS가 이를 구현하여 제공하는 것이다 (OS마다 libc를 다르게 제공함)
- Linux: glibc, msul
- MacOS: libSystem
- Windows: MSVCRT

최종적으로 컴파일러는 링커를 통해 소스 코드에서 참조한 헤더 파일의 표준 라이브러리를 연결하여 바이너리로 빌드한다

그리고 이를 로더/OS 커널을 통해 프로세스를 실행하여 CPU가 명령어를 처리하게 한다

libc는 ABI라고 하는 바이너리 레벨의 계약을 기반으로 구현된다

**ABI(Application Binary Interface)**는 사용자 프로그램과 운영체제 커널 사이의 바이너리 수준 인터페이스 규약으로 시스템 콜, 실행 파일 포맷, 호출 규약, 로딩 방식 등을 정의한다

**운영체제(커널, 실행 모델)**와 **CPU 아키텍처(ISA)**가 ABI를 정의하고 컴파일러, 링커, 로더, 라이브러리가 이 규칙을 따름으로써 운영체제가 프로그램을 실행할 수 있다

주요 OS의 ABI
- System V ABI: Unix 계열, ELF 포맷
- Linux ABI: Linux, ELF 포맷
- Darwin ABI: MacOS/iOS, Mach-O 포맷
- Windows ABI: Windows, PE 포맷

```text
		  유저 공간
┌─────────────────────────┐
│ 	 컴파일러, 링커, 로더      │
│			 ↓			  │
│			libc		  │
└─────────────────────────┘
  			 ↓
		  커널 공간
     ┌─────────────────┐
	 │  ABI: ISA + OS  │
	 └─────────────────┘
```

컴파일러, 링커, 로더는 운영체제, CPU 아키텍처에서 정의한 ABI의 규칙을 따라 각자의 역할을 수행한다

컴파일러가 ABI를 따르는 부분
- 함수 호출 규약
- 레지스터 사용
- 스택 정렬
- 데이터 레이아웃

링커가 ABI를 따르는 부분
- 심볼 해석 규칙
- relocation 방식
- ELF, Mach-O 구조

로더가 ABI를 따르는 부분
- 바이너리 포맷 해석
- 메모리 매핑
- `_start`로 점프

libc가 제공하는 것들: C 표준 함수, POSIX 함수, 런타임 초기화 코드

C 표준 함수: `printf`, `malloc`, `strlen`, `exit` 등 C 표준이 요구하는 것

POSIX 함수: `open`, `read`, `write`, `fork`

런타임 초기화 코드: `_start`, `main()` 호출, 전역 변수 초기화 등 컴파일러가 기대하는 진입점을 제공함

따라서 아래의 `printf` 함수는 아래와 같이 동작한다

```c
printf("Hello World\n");
```

```text
printf  (libc)
   ↓
write   (libc wrapper)
   ↓
syscall (ABI)
   ↓
kernel
```

C 언어는 OS에서 제공하는 컴파일러 드라이버 + C 표준 라이브러리 구현체(libc)의 조합이다

그리고 libc는 OS와 CPU 아키텍처에서 정의한 ABI를 기반으로 구현된다

컴파일러 드라이버 및 OS에 있는 각 컴포넌트의 역할

```text
컴파일러: 기계어 생성

링커: libc 연결

OS 로더: 메모리 배치

커널: 프로세스 실행
```


## POSIX

POSIX (Portable Operating System Interface)는 운영체제 API와 환경에 대한 표준이다

POXIS는 C 코드가 OS에 의존하지 않고 돌아가도록 하는 표준이고, ABI는 컴파일된 프로그램이 OS에서 바로 실행되도록 하는 규칙이다

핵심 목적
- 시스템 콜 표준화
- 유닉스 계열 OS에서 C 프로그램이 이식 가능하도록 보장
- 파일 시스템, 프로세스, 스레드, 신호, 시간 등을 정의

POSIX가 정의하는 영역
- 파일 및 입출력: `open`, `read`, `write`, `close`, 파일 권한/경로 길이/디렉토리 구조
- 프로세스 관리: `fork`, `exec`, `wait`, 환경 변수/종료 상태
- 스레드: POSIX threads (pthreads), mutex, 조건 변수
- 시그널: SIGINT, SIGTERM 같은 표준 시그널, 핸들링 함수 인터페이스
- 시간/예약: clock_gettime, nanosleep
- 환경: 표준 스트림(stdin, stdout, stderr), 로그인 이름 등

POSIX shell: sh, ksh, bash, zsh 등


## C 표준

**C 언어 표준은 서로 다른 시스템에서 같은 의미로 컴파일/실행될 수 있는 최소한의 공통 규칙을 정의한다**

C 언어 표준 제정 공식 기관
- ISO/IEC: 국제 표준화 기구
- JTC1: 정보공동 기술 위원회
- SC22
- WG 14: C 언어 작업 그룹

1980년대 ANSI에서 처음으로 C 표준(ANSI C/C89)을 제정한 뒤 ISO로 이관된다 (C90)

C 언어 표준/버전 목록 [자세한 내용 참고](https://beej.us/guide/bgc/html/split/hello-world.html#c-versions)
- C89: 최초 버전
- C90: C89와 동일
- C95
- C99: 모던 C
- C11
- C17
- C23


## 최종 정리: C 표준, 컴파일러, libc, OS ABI, POSIX, 로더/커널, CPU/ISA

```text
                   ┌─────────────────────────┐
                   │        C 표준 문서        │  
                   │  	  문법과 의미 정의       │
                   └─────────────────────────┘
                               ↓
				┌───────────────────────────────┐
				│      	      컴파일러            │
				│    문법 해석, 오브젝트 파일 생성     │
				└───────────────────────────────┘
                               ↓
				┌─────────────────────────────┐
				│             링커             │
				│   libc 연결, relocation 처리  │
				└─────────────────────────────┘
                               ↓
				┌─────────────────────────┐
				│           libc          │ 
				│  C 표준 + POSIX API 구현  │
				└─────────────────────────┘
							↓
				┌───────────────────────────┐
				│         OS ABI            │
				│ 함수 호출 규약, 데이터 레이아웃, │
				│   시스템 콜 규칙, 파일 포맷     │
				└───────────────────────────┘
							↓
				┌───────────────────────────┐
				│       OS 커널 / 로더        │
				│      실행 파일 로드,         │
				│      메모리 배치, syscall|   │
				└───────────────────────────┘
							↓
			      ┌──────────────────────┐
				  │       CPU / ISA      │  
			      │      실제 명령어 실행    │
				  └──────────────────────┘
```


